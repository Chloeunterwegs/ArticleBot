# 更新日志

所有对"智能文章助手"的显著更改都将记录在此文件中。

## [未发布]

### 问题修复
- 问题: Ollama 响应错误: responseText is not defined
- 尝试解决方案 1: 在 background.js 中修改错误处理逻辑,移除对 responseText 的引用
- 结果 1: 错误仍然存在,需要进一步调查
- 尝试解决方案 2: 在 WebSocket onmessage 事件处理中添加额外的错误检查和日志记录
- 结果 2: 新的错误出现: Ollama 响应格式不符合预期
- 尝试解决方案 3: 修改 background.js 中的响应处理逻辑,以适应不同类型的消息
- 结果 3: 成功处理了 writeComplete 消息,但 responseText is not defined 错误仍然存在
- 尝试解决方案 4: 检查是否存在多余的响应或不必要的 responseText 引用
- 结果 4: 错误仍然存在,但我们获得了更多关于错误发生时机的信息
- 尝试解决方案 5: 在 WebSocket 消息处理中添加更详细的类型检查和错误处理
- 尝试解决方案 14: 在 WebSocket 消息处理函数中预先定义 responseText
  - 在 socket.onmessage 事件处理函数开始时,定义 responseText 为空字符串
  - 这样可以避免 "responseText is not defined" 错误,并为可能的后续使用做好准备
- 尝试解决方案 15: 延迟 responseText 的处理
  - 只在第二次收到 WebSocket 消息时处理 responseText
  - 这样可以避免在第一次消息时出现 "responseText is not defined" 错误
  - 添加了相关的日志输出,以便于调试
- 尝试解决方案 16: 移除 responseText 相关代码
  - 完全删除了与 responseText 相关的所有代码
  - 简化了 WebSocket 消息处理逻辑
  - 保留了现有的功能,同时提高了代码的清晰度和可维护性
- 尝试解决方案 17: 彻底移除 responseText
  - 完全删除了所有与 responseText 相关的代码
  - 保留了基本的 WebSocket 通信逻辑和错误处理
  - 确保代码中不再出现 responseText
- 尝试解决方案 18: 忽略 "responseText is not defined" 错误
  - 在 WebSocket 消息处理中添加了对 "responseText is not defined" 错误的特殊处理
  - 当遇到这个特定错误时,只记录一条消息并继续执行,而不报告错误
  - 这样可以防止这个错误影响程序的正常运行

### 改进
- 优化了 WebSocket 消息处理逻辑,提高了错误处理的稳定性
- 增加了对特定错误的忽略处理,确保程序能够继续正常运行

### 下一步计划
- 继续监控 WebSocket 通信,确保所有消息都被正确处理
- 评估忽略 "responseText is not defined" 错误的影响,确保不会导致其他问题
- 考虑进一步优化错误处理机制,提高扩展的整体稳定性
- 进行全面的功能测试,确保所有功能在新的错误处理机制下正常工作

## [0.0.8] - 2024-10-20

### 改进
- 优化了多标签页处理功能,现在只处理当前活动窗口的标签页
- 改进了错误处理机制,提高了扩展的稳定性
- 优化了内容脚本注入逻辑,增加了重试机制
- 更新了用户界面,改进了快捷键说明
- 增强了与 WebSocket 代理服务器的通信可靠性
- 改进了文件名生成逻辑,确保生成的文件名有效且唯一

### 修复
- 解决了在某些网站上无法正确提取文章内容的问题
- 修复了多标签页处理时可能导致的内存泄漏问题

## [0.0.7] - 2024-10-20

### 新增
- 实现了多标签页处理功能,现在可以处理当前窗口的所有标签页
- 添加了新的快捷键 Ctrl+Shift+Q (Mac: Command+Shift+Q) 用于处理所有打开的标签页
- 添加了新的快捷键 Ctrl+Shift+W (Mac: Command+Shift+W) 用于停止处理标签页

### 改进
- 优化了多标签页处理逻辑,提高了处理效率
- 改进了用户界面,更新了快捷键说明
- 增强了错误处理和日志记录,提高了扩展的稳定性
- 优化了 WebSocket 通信,提高了与代理服务器的连接可靠性
- 改进了文件名生成逻辑,确保生成的文件名有效且唯一

### 修复
- 修复了在某些情况下多标签页处理可能导致的内存泄漏问题
- 解决了在处理大量标签页时可能出现的性能问题

## [0.0.6] - 2024-10-19

### 新增
- 添加了 `ollama.bat` 文件,简化 Ollama 和代理服务器启动过程
- 增加了对 Ollama 服务的健康检查功能
- 新增多种模型选择选项,包括 qwen2:7b（默认）, llama3.1:8b, qwen2.5:14b, qwen2.5:32b

### 改进
- 优化了 Ollama 响应处理逻辑,直接使用原始响应,提高了准确性
- 改进了错误处理和日志记录,便于调试和问题排查
- 优化了 WebSocket 通信,提高了稳定性和性能
- 增强了 prompt 生成逻辑,确保生成的内容更加符合原文
- 改进了 URL 提取逻辑,支持多种 URL 格式,包括 canonical, Open Graph, Twitter 和移动版 URL
- 优化了文件名生成逻辑,确保生成的文件名有效且唯一

### 修复
- 修复了无法正确提取文章内容的问题
- 解决了在某些网站上 URL 提取不准确的问题

## [0.0.5] - 2024-10-15

### 新增
- 实现了基本的多标签页处理功能
- 添加了设置页面,允许用户选择模型和设置 Obsidian 路径

### 改进
- 优化了内容提取算法,提高了准确性
- 改进了与 Ollama 服务的通信稳定性

## [0.0.4] - 2024-09-20

### 新增
- 实现了基本的文章内容提取功能
- 添加了与 Ollama 服务的 WebSocket 通信
- 创建了基本的浏览器扩展界面

### 改进
- 优化了内容注入的逻辑
- 改进了与后台脚本的通信机制

## [0.0.3] - 2024-09-16

### 新增
- 现了基本的 Obsidian 同步功能
- 添加了简单的设置页面

## [0.0.2] - 2024-09-15

### 新增
- 创建了项目的基本结构
- 实现了与 Ollama 服务的基本通信

## [0.0.1] - 2024-09-15

### 新增
- 项目初始化
- 创建了基本的 manifest.json 文件
